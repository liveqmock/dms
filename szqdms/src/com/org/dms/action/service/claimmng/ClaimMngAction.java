package com.org.dms.action.service.claimmng;import com.org.dms.vo.service.SeBaClaimCodeVO;import com.org.dms.vo.service.SeBaExceedDateLogVO;import com.org.dms.vo.service.SeBuClaimVO;import java.util.HashMap;import org.apache.log4j.Logger;import com.org.dms.common.DicConstant;import com.org.dms.dao.service.claimmng.SeBuClaimDao;import com.org.framework.Globals;import com.org.framework.common.User;import com.org.mvc.context.ActionContext;import com.org.framework.common.BaseResultSet;import com.org.framework.common.PageManager;import com.org.framework.util.Pub;import com.org.framework.util.RequestUtil;import com.org.mvc.context.RequestWrapper;import com.org.framework.log.LogManager;; /**   * 索赔单   * <p>Company: szq</p>   * @author baixiaoliang   * @version 1.0  2014-7-14  */public class ClaimMngAction{ 		   private Logger logger = com.org.framework.log.log.getLogger("ClaimMngAction");		   private ActionContext atx = ActionContext.getContext();   private SeBuClaimDao dao=SeBuClaimDao.getInstance(atx);  /**   * @auther baixiaoliang   * 索赔单新增   * @return void  */    public void insert() throws Exception { 			RequestWrapper request = atx.getRequest();           User user = (User) atx.getSession().get(Globals.USER_KEY);            try            {            SeBuClaimVO vo = new SeBuClaimVO();            //SeBuClaimVO_Ext voExt=new SeBuClaimVO_Ext();            HashMap<String,String> hm;            hm = RequestUtil.getValues(request);            vo.setValue(hm);            //voExt.setValue(hm);            vo.setCreateUser(user.getAccount());            vo.setCreateTime(Pub.getCurrentDate());            dao.insert(vo);            vo.bindFieldToDic("STATUS","YXBS");            //	voExt.setClaimId(vo.getClaimId());           //voExt.bindFieldToDic("STATUS","YXBS");           //voExt.bindFieldToDic("USER_TYPE","CLYHLX");           //atx.setOutMsg(voExt.getRowXml(),"索赔单新增成功！");            atx.setOutMsg(vo.getRowXml(),"索赔单新增成功！");       }           catch (Exception e)       {      atx.setException(e);      logger.error(e);       }       } /**   * @auther baixiaoliang   * 索赔单新增   * @return void  */    public void update() throws Exception { 			RequestWrapper request = atx.getRequest();           User user = (User) atx.getSession().get(Globals.USER_KEY);            try            {            SeBuClaimVO vo = new SeBuClaimVO();            //SeBuClaimVO_Ext voExt=new SeBuClaimVO_Ext();            HashMap<String,String> hm;            hm = RequestUtil.getValues(request);            vo.setValue(hm);            //voExt.setValue(hm);            vo.setUpdateUser(user.getAccount());            vo.setUpdateTime(Pub.getCurrentDate());            dao.update(vo);            //voExt.setClaimId(vo.getClaimId());           //voExt.bindFieldToDic("STATUS","YXBS");           //voExt.bindFieldToDic("USER_TYPE","CLYHLX");           //atx.setOutMsg(voExt.getRowXml(),"索赔单修改成功！");            atx.setOutMsg(vo.getRowXml(),"索赔单修改成功！");              LogManager.writeUserLog("","",Globals.OPERATION_TYPE_INSERT,LogManager.RESULT_SUCCESS              , "修改 [" + vo.getClaimId() + " 成功", user);       }           catch (Exception e)       {      atx.setException(e);      logger.error(e);      	LogManager.writeUserLog("", "", Globals.OPERATION_TYPE_INSERT,      	LogManager.RESULT_FAILURE, "索赔单失败：" + e.toString(),      user);       }       }    /**     * 批量更新     * @throws Exception     * @Author suoxiuli 2014-07-15     */    public void updateAll() throws Exception    {    	RequestWrapper request = atx.getRequest();        User user = (User) atx.getSession().get(Globals.USER_KEY);        String claimIds = Pub.val(request, "claimIds");        SeBuClaimVO vo=new SeBuClaimVO();        try        {			HashMap<String, String> hm;			hm = RequestUtil.getValues(request);			vo.setValue(hm);			// voExt.setValue(hm);			vo.setUpdateUser(user.getAccount());			vo.setUpdateTime(Pub.getCurrentDate());//			String userAccount = hm.get("USER_ACCOUNT");//			String userName = hm.get("PERSON_NAME");//			String updateUser = user.getAccount();            dao.updateAll(claimIds,vo);            atx.setOutMsg(vo.getRowXml(),"索赔基础费用批量修改成功！");        }        catch (Exception e)        {        	//设置失败异常处理        	atx.setException(e);            logger.error(e);        }    }     /**   * @auther baixiaoliang   * 索赔单删除   * @return void  */    public void delete() throws Exception { 			RequestWrapper request = atx.getRequest();            String status = Pub.val(request, "status");            String claimId = Pub.val(request, "claimId");            try            {            if(DicConstant.YXBS_02.equals(status)){              dao.delete(claimId);              atx.setOutMsg("","索赔单额删除成功！");              }else{              atx.setOutMsg("","只有无效的才可以进行删除操作！");              }       }           catch (Exception e)       {      atx.setException(e);      logger.error(e);       }       } /**   * @auther baixiaoliang   * 索赔单查询   * @return void  */    public void search() throws Exception { 			RequestWrapper request = atx.getRequest();           User user = (User) atx.getSession().get(Globals.USER_KEY); 			PageManager page = new PageManager();           String conditions = RequestUtil.getConditionsWhere(request,page);            try            {         BaseResultSet bs = dao.search(page,user,conditions);         atx.setOutData("bs", bs);       }           catch (Exception e)       {      atx.setException(e);      logger.error(e);       }       }        /**     * @auther baixiaoliang     * 索赔单超期查询     * @return void    */      public void searchClaim() throws Exception {   			RequestWrapper request = atx.getRequest();             User user = (User) atx.getSession().get(Globals.USER_KEY);   			PageManager page = new PageManager();             String conditions = RequestUtil.getConditionsWhere(request,page);              try              {           BaseResultSet bs = dao.searchClaim(page,user,conditions);           atx.setOutData("bs", bs);         }             catch (Exception e)         {        atx.setException(e);        logger.error(e);         }         }     /**   * @auther baixiaoliang   * 索赔单删除   * @return void  */    public void resetStatus() throws Exception { 			RequestWrapper request = atx.getRequest(); 		User user = (User) atx.getSession().get(Globals.USER_KEY);            String status = Pub.val(request, "status");            String claimId = Pub.val(request, "claimId");            try            {            SeBuClaimVO vo = new SeBuClaimVO();             vo.setClaimId(claimId);             vo.setUpdateUser(user.getAccount());             	vo.setUpdateTime(Pub.getCurrentDate());            	vo.setStatus(status);             dao.update(vo);              atx.setOutMsg("","索赔单删除成功！");       }           catch (Exception e)       {      atx.setException(e);      logger.error(e);       }       }}
